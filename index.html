<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VideoFire - Powered by Telegram</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

  <!-- Video.js -->
  <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
  <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>

  <!-- Telegram Login -->
  <script async src="https://telegram.org/js/telegram-widget.js?7"
    data-telegram-login="Videofire_bot"
    data-size="large"
    data-userpic="true"
    data-request-access="write"
    data-userpic="true"
    data-on-auth="onTelegramAuth">
  </script>

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #111;
      color: #fff;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: #1a1a1a;
    }
    .logo {
      font-size: 24px;
      font-weight: bold;
    }
    .search-bar {
      flex: 1;
      margin: 0 15px;
    }
    .search-bar input {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: none;
    }
    .container {
      display: flex;
      height: calc(100vh - 60px);
    }
    .sidebar {
      width: 250px;
      background: #222;
      padding: 10px;
      overflow-y: auto;
    }
    .main-content {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }
    .video-card {
      background: #333;
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
    }
    .video-card img {
      width: 100%;
      border-radius: 8px;
    }
    .profile-section {
      text-align: center;
      padding: 20px;
    }
    .profile-section img {
      border-radius: 50%;
      width: 100px;
    }
    .upload-form {
      margin-top: 20px;
    }
    .upload-form input, .upload-form textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 4px;
      border: none;
    }
    .upload-form button {
      padding: 10px;
      background: #e91e63;
      border: none;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <header>
    <div class="logo">VideoFire ðŸ”¥</div>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search videos...">
    </div>
    <div id="telegramLogin"></div>
  </header>

  <div class="container">
    <div class="sidebar">
      <div class="profile-section">
        <img id="profilePic" src="https://via.placeholder.com/100" alt="Profile">
        <h3 id="username">Guest</h3>
        <p id="viewsCounter">Views: 0</p>
        <p id="earningsCounter">Earnings: â‚¹0</p>
        <button id="withdrawBtn" style="display:none;">Withdraw</button>
      </div>
    </div>

    <div class="main-content" id="videoList"></div>
  </div>

  <div style="position: fixed; bottom: 20px; right: 20px;">
    <button onclick="showUploadForm()">âž• Upload Video</button>
  </div>

  <div id="uploadModal" style="display:none; position: fixed; top:10%; left:50%; transform: translateX(-50%); background:#222; padding:20px; border-radius:8px;">
    <h3>Upload New Video</h3>
    <div class="upload-form">
      <input type="text" id="videoTitle" placeholder="Video Title">
      <textarea id="videoDesc" placeholder="Description (max 400 words)"></textarea>
      <input type="text" id="videoTags" placeholder="Tags (comma separated, max 300 words)">
      <input type="text" id="videoLink" placeholder="Telegram Video Link">
      <button onclick="uploadVideo()">Upload</button>
    </div>
  </div>

  <!-- Firebase Config -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDes3ioeygnWBqJB6NnHb7xj732JJhOqm8",
      authDomain: "videofire-268ff.firebaseapp.com",
      databaseURL: "https://videofire-268ff-default-rtdb.firebaseio.com",
      projectId: "videofire-268ff",
      storageBucket: "videofire-268ff.appspot.com",
      messagingSenderId: "910374058927",
      appId: "1:910374058927:web:6add3afdea07cfa2914d5a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <!-- App Logic -->
  <script>
    let currentUser = null;
    const requiredViews = 20000;

    function onTelegramAuth(user) {
      currentUser = user;
      document.getElementById("telegramLogin").style.display = "none";
      document.getElementById("username").innerText = user.username;
      document.getElementById("profilePic").src = user.photo_url;

      db.ref('users/'+user.id).once('value').then(snapshot => {
        if (!snapshot.exists()) {
          db.ref('users/'+user.id).set({
            id: user.id,
            username: user.username,
            views: 0
          });
        }
      });

      loadVideos();
      loadProfile();
    }

    function loadVideos() {
      db.ref('videos').on('value', snapshot => {
        document.getElementById('videoList').innerHTML = '';
        snapshot.forEach(child => {
          const vid = child.val();
          const card = document.createElement('div');
          card.className = 'video-card';
          card.innerHTML = `<img src="https://via.placeholder.com/320x180?text=${vid.title}">
            <h4>${vid.title}</h4><p>${vid.description.substring(0,50)}...</p>`;
          card.onclick = () => playVideo(child.key, vid.videoLink);
          document.getElementById('videoList').appendChild(card);
        });
      });
    }

    function loadProfile() {
      db.ref('users/'+currentUser.id).on('value', snap=>{
        const data = snap.val();
        document.getElementById("viewsCounter").innerText = `Views: ${data.views}`;
        const earning = (data.views/1000)*10;
        document.getElementById("earningsCounter").innerText = `Earnings: â‚¹${earning}`;

        if (data.views >= requiredViews) {
          document.getElementById("withdrawBtn").style.display = "block";
          document.getElementById("withdrawBtn").onclick = ()=>{
            window.open("https://t.me/Apknixyapp", "_blank");
          }
        }
      });
    }

    function showUploadForm() {
      if (!currentUser) return alert("Please login first!");
      document.getElementById("uploadModal").style.display = "block";
    }

    function uploadVideo() {
      const title = document.getElementById("videoTitle").value;
      const description = document.getElementById("videoDesc").value;
      const tags = document.getElementById("videoTags").value;
      const videoLink = document.getElementById("videoLink").value;

      const vidRef = db.ref('videos').push();
      vidRef.set({
        uploaderId: currentUser.id,
        title, description, tags, videoLink, views: 0
      }).then(()=>{
        alert("Video Uploaded Successfully!");
        document.getElementById("uploadModal").style.display = "none";
      });
    }

    function playVideo(videoId, videoLink) {
      alert("Playing Ad first...");
      window.open("https://s.magsrv.com/v1/vast.php?idzone=5609878", "_blank");

      setTimeout(()=>{
        window.open(videoLink, "_blank");

        const vidRef = db.ref(`videos/${videoId}/views`);
        vidRef.once('value').then(snap=>{
          const views = (snap.val()||0)+1;
          vidRef.set(views);
        });

        const userRef = db.ref(`users/${currentUser.id}/views`);
        userRef.once('value').then(snap=>{
          const totalViews = (snap.val()||0)+1;
          userRef.set(totalViews);
        });

      }, 3000);
    }
  </script>

  <!-- Popunder -->
  <script>
    document.body.addEventListener('click', () => {
      window.open("https://www.profitableratecpm.com/ekqigjxxf?key=7cc9b0386975c414c8ab9629f405b0dc", "_blank");
    }, { once: true });
  </script>

</body>
</html>
